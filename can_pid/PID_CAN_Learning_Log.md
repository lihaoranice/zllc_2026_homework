# PID算法和CAN通信学习日志

## 日期：2025年11月29日

## 学习目标
- 理解PID控制算法的基本原理和实现方法
- 掌握CAN通信协议在电机控制中的应用
- 分析并优化现有的DJI-3508电机控制代码

## 学习内容

### 1. PID控制算法理解

#### 1.1 PID基本概念
PID控制器由三个部分组成：
- **比例项(P)**：根据当前误差大小进行调整
- **积分项(I)**：根据误差累积进行调整，消除稳态误差
- **微分项(D)**：根据误差变化率进行调整，预测未来趋势

#### 1.2 PID数学表达式
```
输出 = Kp * 误差 + Ki * ∫误差dt + Kd * d(误差)/dt
```

#### 1.3 PID参数调节经验
- 先调Kp，再调Kd，最后调Ki
- Kp过大容易引起振荡，过小响应慢
- Ki过大容易引起积分饱和和振荡
- Kd有助于减少超调和提高稳定性

### 2. CAN通信协议理解

#### 2.1 CAN协议特点
- 多主机方式工作，无需调度
- 具有较高传输速率（最高1Mbps）
- 具有错误检测和处理机制
- 采用非破坏性仲裁技术

#### 2.2 DJI-3508电机CAN通信
- **控制帧ID**：0x200
- **反馈帧ID**：0x201-0x204（对应电机1-4）
- **数据格式**：8字节
  - 控制帧：每两个字节表示一个电机的电流值
  - 反馈帧：角度(2字节)、速度(2字节)、电流(2字节)、温度(1字节)、空(1字节)

### 3. 代码分析与优化

#### 3.1 发现的问题
1. **积分饱和问题**：积分项没有适当限制，导致电机持续加速
2. **微分项计算不准确**：未考虑采样时间间隔
3. **参数设置不合理**：初始PID参数不适合实际控制场景
4. **角度控制逻辑缺陷**：使用单圈角度而非连续角度

#### 3.2 解决方案
1. **修复积分饱和**：
   - 添加积分限幅机制
   - 积分项乘以采样时间间隔

2. **改进微分项计算**：
   - 微分项除以采样时间间隔
   - 在主循环中计算实际时间间隔

3. **优化PID参数**：
   - 调整为更适合实际控制的参数
   - 角度环：Kp=2.0, Ki=0.01, Kd=0.1
   - 速度环：Kp=2.0, Ki=0.01, Kd=0.1

4. **改善角度控制**：
   - 使用连续角度进行计算
   - 实现更平滑的比例控制策略

### 4. 实验结果
经过优化后的PID控制算法能够：
- 有效防止积分饱和现象
- 提供更稳定的微分控制
- 使电机速度能够稳定在目标值附近，而不会持续加速到最大值
- 实现更精确的角度控制

## 总结
通过本次学习，深入理解了PID控制算法的核心原理和实际应用中的注意事项。同时掌握了CAN通信在电机控制中的具体实现方式。通过对现有代码的分析和优化，解决了电机持续加速的问题，提升了控制系统的稳定性和准确性。

## 下一步计划
- 进一步优化PID参数，根据不同负载情况进行调整
- 实现更复杂的控制策略，如自适应PID
- 增加更多的调试信息输出，便于实时监控系统状态